From f65bd0b466d577ff3c51d0e0329e94e8a0194989 Mon Sep 17 00:00:00 2001
From: Paul Cacheux <paul.cacheux@datadoghq.com>
Date: Fri, 1 Apr 2022 11:39:27 +0200
Subject: [PATCH] Add `LoadKernelSpecWithoutCache`

---
 btf/btf.go | 8 ++++----
 1 file changed, 4 insertions(+), 4 deletions(-)

diff --git a/btf/btf.go b/btf/btf.go
index a22a9b9..61c8ccb 100644
--- a/btf/btf.go
+++ b/btf/btf.go
@@ -13,7 +13,7 @@ import (
 	"sort"
 	"sync"
 
-	"github.com/DataDog/btf-internals"
+	internal "github.com/DataDog/btf-internals"
 	"github.com/DataDog/btf-internals/sys"
 	"github.com/DataDog/btf-internals/unix"
 )
@@ -341,14 +341,14 @@ func LoadKernelSpec() (*Spec, error) {
 	}
 
 	var err error
-	kernelBTF.Spec, err = loadKernelSpec()
+	kernelBTF.Spec, err = LoadKernelSpecWithoutCache()
 	return kernelBTF.Spec, err
 }
 
-// loadKernelSpec attempts to load the raw vmlinux BTF blob at
+// LoadKernelSpecWithoutCache attempts to load the raw vmlinux BTF blob at
 // /sys/kernel/btf/vmlinux and falls back to scanning the file system
 // for vmlinux ELFs.
-func loadKernelSpec() (*Spec, error) {
+func LoadKernelSpecWithoutCache() (*Spec, error) {
 	fh, err := os.Open("/sys/kernel/btf/vmlinux")
 	if err == nil {
 		defer fh.Close()
